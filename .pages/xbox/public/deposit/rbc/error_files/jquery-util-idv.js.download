$.extend({

    validateSourceApplication: function(sourceApplication) {
        return sourceApplication == "idv";
    },

    validateGOTO: function(goto) {
        return goto == "idv";
    },

    validateB64Encoding: function(str) {
        return str.match(/^[A-Za-z0-9_-]+$/g) != null;
    },

    validateTicket: function (ticket) {
        return ticket.length == 76 && $.validateB64Encoding(ticket);
    },

    validateJwt: function (jwt) {
        jwtParts = jwt.split(".");
        if (jwtParts.length != 3) {
            return false;
        }
        return $.validateB64Encoding(jwtParts[0]) && $.validateB64Encoding(jwtParts[1]) && $.validateB64Encoding(jwtParts[2]);
    },

    validateDestination: function (destination) {
        return destination.length <= 40;
    },

    validateDocumentType: function (documentType) {
        return documentType == "DRIVER_LICENSE" || documentType == "PASSPORT" || documentType == "EPASSPORT" || documentType == "USER_DEFINED";
    },

    validateTarget: function(target) {
        // letters only and length <= 20
        return target.match(/^[A-Za-z]+$/g) && target.length <= 20;
    },

    isEmpty: function(str) {
        return str === undefined || str === null;
    },

    validateParams: function () {
        var source_application = $.getUrlVar('source_application');
        var prospectJWT = $.getUrlVar('prospectJWT');
        var documentType = $.getUrlVar('documentType');
        var challenge_code = $.getUrlVar('challenge_code');
        var destination = $.getUrlVar('destination');
        var token = $.getUrlVar('token');
        var target = $.getUrlVar('target');
        var ticket = $.getUrlVar('ticket');
        var goto = $.getUrlVar('GOTO');

        var isValidSrcApplication = source_application && $.validateSourceApplication(source_application);
        var isValidProspect = prospectJWT && $.validateJwt(prospectJWT);
        var isValidToken = $.isEmpty(token) || $.validateJwt(token);
        var isValidTicket = $.isEmpty(ticket) || $.validateTicket(ticket);
        var isValidDocumentType = documentType && $.validateDocumentType(documentType);
        var isValidChallengeCode = !$.isEmpty(challenge_code);
        var isValidDestination = $.isEmpty(destination) || $.validateDestination(destination);
        var isValidTarget = $.isEmpty(target) || $.validateTarget(target);
        var isValidGOTO = $.validateGOTO(goto);

        return isValidSrcApplication && isValidProspect && isValidToken && isValidChallengeCode &&
            isValidTicket && isValidDocumentType && isValidDestination && isValidTarget && isValidGOTO;
    },

    /**
      * Launch IPhone App with Lock parameters if already installed
      *
      * @method launchIPhoneAppIDV
      */
    launchIPhoneAppIDV: function () {
        var prospectJWT = $.getUrlVar('prospectJWT');
        var source_application = $.getUrlVar('source_application');
        var documentType = $.getUrlVar('documentType');
        var challenge_code = $.getUrlVar('challenge_code');
        var selfie = $.getUrlVar('selfie');
        var destination = $.getUrlVar('destination');
        var token = $.getUrlVar('token');
        var target = $.getUrlVar('target');
        var gaClientId = $.getUrlVar('gaClientId');
        var ticket = $.getUrlVar('ticket');
        var goTo = "idv";
        var appURL ="";

        if($.isEmpty(selfie)) {
           selfie = false;
        }

        appURL = "rbcmobile://idv"
                + "?prospectJWT=" + prospectJWT
                + "&source_application=" + source_application
                + "&documentType=" + documentType
                + "&challenge_code=" + challenge_code
                + "&selfie=" + selfie;


        if (!$.isEmpty(destination)) {
            appURL = appURL + "&destination=" + destination;
        }

        if (!$.isEmpty(token)) {
            appURL = appURL + "&token=" + token;
        }

        if (!$.isEmpty(target)) {
            appURL = appURL + "&target=" + target;
        }

        if (!$.isEmpty(gaClientId)) {
            appURL = appURL + "&gaClientId=" + gaClientId;
        }

        if (!$.isEmpty(ticket)) {
            appURL = appURL + "&ticket=" + ticket;
        }

        appURL = appURL + "&GOTO=" + goTo;
        window.location = appURL;
    },

    /**
    * Launch Android App with IDV parameters if already installed
    *
    * @method launchAndroidAppIDV
    */
    launchAndroidAppIDV: function () {
        var prospectJWT = $.getUrlVar('prospectJWT');
        var source_application = $.getUrlVar('source_application');
        var documentType = $.getUrlVar('documentType');
        var challenge_code = $.getUrlVar('challenge_code');
        var selfie = $.getUrlVar('selfie');
        var destination = $.getUrlVar('destination');
        var token = $.getUrlVar('token');
        var target = $.getUrlVar('target');
        var gaClientId = $.getUrlVar('gaClientId');
        var ticket = $.getUrlVar('ticket');
        var goTo = "idv";
        var appURL = "";

        if($.isEmpty(selfie)){
            selfie = false;
        }

        appURL = "intent://idv"
                + "?prospectJWT=" + prospectJWT
                + "&source_application=" + source_application
                + "&documentType=" + documentType
                + "&challenge_code=" + challenge_code
                + "&selfie=" + selfie;

        if (!$.isEmpty(destination)) {
            appURL = appURL + "&destination=" + destination;
        }

        if (!$.isEmpty(token)) {
            appURL = appURL + "&token=" + token;
        }

        if (!$.isEmpty(target)) {
            appURL = appURL + "&target=" + target;
        }

        if (!$.isEmpty(gaClientId)) {
            appURL = appURL + "&gaClientId=" + gaClientId;
        }

        if (!$.isEmpty(ticket)) {
            appURL = appURL + "&ticket=" + ticket;
        }

        appURL = appURL + "&GOTO=" + goTo + "#Intent;scheme=rbcbanking;package=com.rbc.mobile.android;end";
        window.parent.location = appURL;
    },
});